# Node.js with React
# Build a Node.js project that uses React.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/javascript

trigger:
- main

jobs:
  - job: 'NodeBuild'
    pool:
      name: szecsikr
    steps:
    - task: NodeTool@0
      inputs:
        versionSpec: '20.x'
      displayName: 'Install Node.js'

    - script: |
        cd frontend/chat-app
        npm install
        npm run build
      displayName: 'npm install and build'

  - job: 'DockerBuild'
    pool:
      name: szecsikr
    steps:
    - task: DockerInstaller@0
      inputs:
        dockerVersion: '17.09.0-ce' # string. Required. Docker Version. Default: 17.09.0-ce.
        #releaseType: 'stable' # 'stable' | 'edge' | 'test' | 'nightly'. Release type. Default: stable.
    - task: Docker@2
      inputs:
        repository: szecsikr/chatapp
        command: build
        Dockerfile: frontend/chat-app/Dockerfile
      displayName: 'Build an image'
    - task: Docker@2
      inputs:
        repository: 'szecsikr/chatapp-backend:latest'
        command: 'buildAndPush'
        Dockerfile: '**/Dockerfile'